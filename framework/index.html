<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="..\static\style.css" ;>

  <meta charset="UTF-8">
  <title>CalenPal</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>


<!-- BODY -->


<body>
  <!-- Header -->
  <div class="header">

    <div class="left">
      <div class="titleAndSubtitle">
        <div class="title">CalenPal</div>
        <div class="subtitle" style="padding-left:15px;">Schedule your stress</div>
      </div>

      <img src="../static/logo.png" alt="Logo" class="logo">
    </div>


    <input type="file" id="fileInput" style="display:none;">
    <div class="upload-group">
      <button id="uploadBtn" class="upload-btn">Upload Syllabus</button>
      <button id="uploadBtnE" class="upload-btn">Upload Event</button>
    </div>
  </div>




  <!-- Dialog for adding event -->
  <dialog id="eventDialog">
    <h2>Upload Event Details</h2> <br>
    <form id="eventUploadForm" method="dialog">
      <label for="eventTitle">Event Title:</label>
      <input type="text" id="eventTitle" name="eventTitle" required><br><br>

      <label for="eventDate">Event Date:</label>
      <input type="date" id="eventDate" name="eventDate" required><br><br>

      <label for="eventTitle">Event Time:</label>
      <input id="appt-time" type="time" name="appt-time" value="13:30"><br><br>

      <label for="eventDesc">Event Description:</label>
      <textarea id="eventDesc" name="eventDesc" rows="4" cols="50"></textarea><br><br>
      <div class="slidecontainer">
        <label for="StressLevel">Stress Level:</label>
        <span id="sliderValue">5</span>
        <input type="range" min="1" max="10" value="5" class="slider" id="myRange"><br><br>
      </div>


      <style>
        .importance-fieldset {
          padding: 10px 0;
          display: flex;
          gap: 30px;
          /* space between choices */
          align-items: center;
          /* space above and below the fieldset */
        }
      </style>
      <fieldset class="importance-fieldset">
        <legend>Importance?</legend>
        <label><input type="radio" name="importance" value="low"> Low</label>
        <label><input type="radio" name="importance" value="medium"> Medium</label>
        <label><input type="radio" name="importance" value="high"> High</label> <br><br>
      </fieldset>      <br>
      <button type="submit" class="submit-btn">Submit Event</button>
      <button type="button" id="closeDialog" class="submit-btn">Close</button>

    </form>
  </dialog>
  <hr>

  <!-- Main Layout -->
  <div class="main">

    <!-- Calendar will be loaded here -->

    <div class="calendar">
      <div class="header">
        <button id="prevBtn">
          <i class="fa-solid fa-chevron-left"></i>
        </button>
        <div class="month-year" id="monthYear"></div>
        <button id="nextBtn">
          <i class="fa-solid fa-chevron-right"></i>
        </button>
      </div>
      <div class="days">
        <div class="day">Sun</div>
        <div class="day">Mon</div>
        <div class="day">Tue</div>
        <div class="day">Wed</div>
        <div class="day">Thu</div>
        <div class="day">Fri</div>
        <div class="day">Sat</div>
      </div>
      <div class="dates" id="dates"></div>
    </div>

    <script src="..\static\script.js"></script>


    <!-- Main White Box -->
    <div class="content-box" id="eventsBox">
        <div id="eventsBox" class="event-box">
  <p class="placeholder"> ⬅️Select a date to see events</p>
  </div>

      
    </div>
  </div>

  <!-- Bottom -->
  <div class="bottom">
    <!-- Output box (fixed height, scrollable) -->
    <div id="responseBox" class="response-box"></div>

    <!-- Input bar -->
    <form id="askForm" class="input-bar">
      <input type="text" id="askInput" placeholder="Type your message..." required>
      <button type="submit" class="ask-btn">Ask CalenPal</button>
    </form>
  </div>


  <script>

    // Handle ask form submit
    document.getElementById("askForm").addEventListener("submit", async function (event) {
      event.preventDefault();

      const message = document.getElementById("askInput").value;

      try {
        const response = await fetch("/ask-agent", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ query: message })
        });

        const data = await response.json();
        console.log("Backend response:", data);

        // Show only latest response
        document.getElementById("responseBox").innerText = JSON.parse(data).body || "No response";
      } catch (error) {
        console.error("Error:", error);
      }

      document.getElementById("askInput").value = "";
    });

  </script>

  <script>
    const uploadBtn = document.getElementById('uploadBtn');
    const fileInput = document.getElementById('fileInput');

    uploadBtn.addEventListener('click', (e) => {
      e.preventDefault();
      fileInput.click();
    });

    fileInput.addEventListener('change', async (e) => {
      if (fileInput.files.length > 0) {
        console.log('Selected file:', fileInput.files[0]);
        const file = e.target.files[0];
        const formData = new FormData();
        formData.append('file', file);

        const res = await fetch("/upload-syllabus", {
          method: "POST",
          body: formData
        });

        const data = await res.json();
        console.log("Syllabus processed:", data);
        alert("Added ${data.added} events from syllabus!");
      }
    });
  </script>


</body>

</html>